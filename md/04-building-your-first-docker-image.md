# Урок 4: Создание первого образа Docker

## Введение в Dockerfile

**Dockerfile** — это текстовый файл, содержащий ряд инструкций по созданию образа Docker. Он определяет базовый образ, код приложения, зависимости и любые другие конфигурации, необходимые для создания образа.

### Ключевые компоненты Dockerfile:
- **FROM**: Указывает базовый образ для использования.
- **COPY**: Копирует файлы из локальной файловой системы в образ.
- **RUN**: Выполняет команды в образе во время процесса сборки.
- **CMD**: Указывает команду для запуска при запуске контейнера из образа.

## Шаг 1: Написание простого Dockerfile

Давайте создадим простой Dockerfile для создания образа, который запускает простое веб-приложение с использованием Python. Выполните следующие шаги:

### Создайте каталог проекта

1. Откройте терминал и создайте новый каталог для вашего проекта:

```bash
mkdir my-python-app
cd my-python-app
```

### Создайте простое приложение Python

2. Создайте файл с именем `app.py` в каталоге `my-python-app` со следующим содержимым:

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
return "Hello, Docker!"

if __name__ == '__main__':
app.run(host='0.0.0.0')
```

### Создайте Dockerfile

3. В том же каталоге создайте файл с именем `Dockerfile` (без расширения) и добавьте следующее содержимое:

```dockerfile
# Используйте официальный образ Python из Docker Hub
FROM python:3.9-slim

# Установите рабочий каталог в контейнере
WORKDIR /app

# Скопируйте файл требований и установите зависимости
COPY requirements.txt requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Скопируйте код приложения в контейнер
COPY app.py app.py

# Откройте порт, на котором работает приложение
EXPOSE 5000

# Команда для запуска приложения
CMD ["python", "app.py"]
```

### Создайте файл требований

4. Создайте файл с именем `requirements.txt` в том же каталоге и добавьте следующую строку:

```
Flask
```

## Шаг 2: Создайте свой образ Docker

Теперь, когда есть готовый Dockerfile и код приложения, можно создать свой образ Docker.

### Создание образа

1. В терминале перейдите в каталог `my-python-app`  и выполните следующую команду для создания образа:

```bash
docker build -t my-python-app .
```

- Флаг `-t` помечает образ именем (`my-python-app`).
- `.` в конце указывает контекст сборки (текущий каталог).

### Проверка образа

2. После завершения процесса сборки проверьте, что образ был создан, запустив:

```bash
docker images
```

Вы должны увидеть `my-python-app` в списке доступных образов.

## Шаг 3: Запустите ваш образ Docker

Теперь, когда образ создан, можно запустить его как контейнер.

### Запустите контейнер

1. Используйте следующую команду для запуска вашего контейнера Docker:

```bash
docker run -p 5000:5000 my-python-app
```

- Флаг `-p` сопоставляет порт 5000 на вашем хост-компьютере с портом 5000 в контейнере.

### Доступ к приложению

2. Откройте веб-браузер и перейдите по адресу `http://localhost:5000`. Вы должны увидеть сообщение:

```
Hello, Docker!

```

## Шаг 4: Остановка контейнера

Чтобы остановить работающий контейнер, вы можете нажать `Ctrl + C` в терминале, где запущен контейнер, или открыть новый терминал и выполнить:

```bash
docker ps
```

Найдите идентификатор или имя контейнера, затем остановите его с помощью:

```bash
docker stop <container-id>
```

## Заключение

В этом уроке вы узнали, как написать простой Dockerfile для создания пользовательского образа Docker и как создать и запустить этот образ локально. Теперь у вас есть базовые знания о том, как упаковывать приложения с помощью Docker. В следующем уроке мы рассмотрим основы работы в сети Docker и то, как контейнеры взаимодействуют друг с другом.

## Лабораторная работа 2. "Создание Dockerfile и сборка образа"

### Цель работы: Научиться создавать Dockerfile и собирать образы Docker для приложений.

### Задачи:
1. Создать Dockerfile для указанного приложения.
2. Собрать образ Docker с использованием созданного Dockerfile.
3. Запустить контейнер из собранного образа и проверить его работоспособность.
4. Выполнить индивидуальное задание.

### Критерии оценки:
- Правильность создания Dockerfile (3 балла)
- Корректность сборки образа Docker (3 балла)
- Работоспособность запущенного контейнера (2 балла)
- Выполнение индивидуального задания (2 балла)

### Ход работы (пример для Варианта 25):

1. Создание Dockerfile для приложения на Flask
- Создайте новый каталог для проекта и перейдите в него:
  ```
  mkdir flask-app
  cd flask-app
  ```
- Создайте файл `app.py` со следующим содержимым:
  ```python
  from flask import Flask

  app = Flask(__name__)

  @app.route('/')
  def hello():
      return "Hello, World!"

  if __name__ == '__main__':
      app.run(host='0.0.0.0', port=5000)
  ```
- Создайте файл `requirements.txt` со следующим содержимым:
  ```
  Flask
  ```
- Создайте файл `Dockerfile` со следующим содержимым:
  ```
  FROM python:3.9-slim

  WORKDIR /app

  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt

  COPY app.py .

  EXPOSE 5000

  CMD ["python", "app.py"]
  ```

2. Сборка образа Docker
- Находясь в каталоге проекта, выполните команду для сборки образа:
  ```
  docker build -t flask-app .
  ```

3. Запуск контейнера
- Запустите контейнер из собранного образа:
  ```
  docker run -d --name my-flask-app -p 5000:5000 flask-app
  ```
- Откройте веб-браузер и перейдите по адресу `http://localhost:5000`. Вы должны увидеть сообщение "Hello, World!".

4. Остановка и удаление контейнера
- Остановите контейнер:
  ```
  docker stop my-flask-app
  ```
- Удалите контейнер:
  ```
  docker rm my-flask-app
  ```

### Индивидуальные задания:

**Вариант 1.** Создайте `Dockerfile` для приложения на `Node.js`, которое выводит "Hello, Node.js!" при доступе к корневому URL.

**Вариант 2.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку `NumPy` для генерации случайной матрицы 3x3.

**Вариант 3.** Создайте `Dockerfile` для приложения на `Java`, которое выводит "Hello, Java!" при запуске.

**Вариант 4.** Создайте `Dockerfile` для приложения на `PHP`, которое выводит "Hello, PHP!" при доступе к корневому URL.

**Вариант 5.** Создайте `Dockerfile` для приложения на `Ruby`, которое выводит "Hello, Ruby!" при доступе к корневому URL.

**Вариант 6.** Создайте `Dockerfile` для приложения на `Go`, которое выводит "Hello, Go!" при запуске.

**Вариант 7.** Создайте `Dockerfile` для приложения на `C++`, которое выводит "Hello, C++!" при запуске.

**Вариант 8.** Создайте `Dockerfile` для приложения на `Rust`, которое выводит "Hello, Rust!" при запуске.

**Вариант 9.** Создайте `Dockerfile` для веб-сервера `Nginx`, который обслуживает статический HTML-файл с надписью "Hello, Nginx!".

**Вариант 10.** Создайте `Dockerfile` для веб-сервера `Apache`, который обслуживает статический HTML-файл с надписью "Hello, Apache!".

**Вариант 11.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку Pandas для чтения CSV-файла и вывода его содержимого.

**Вариант 12.** Создайте `Dockerfile` для приложения на `Node.js`, которое подключается к базе данных MongoDB и выводит список коллекций.

**Вариант 13.** Создайте `Dockerfile` для приложения на `Java`, которое использует библиотеку JDBC для подключения к базе данных PostgreSQL и выполнения простого запроса.

**Вариант 14.** Создайте `Dockerfile` для приложения на `PHP`, которое использует библиотеку PDO для подключения к базе данных MySQL и выполнения простого запроса.

**Вариант 15.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку Flask для создания простого REST API с одним конечной точкой.

**Вариант 16.** Создайте `Dockerfile` для приложения на `Node.js`, которое использует библиотеку Express для создания простого REST API с одним конечной точкой.

**Вариант 17.** Создайте `Dockerfile` для приложения на `Java`, которое использует фреймворк Spring Boot для создания простого REST API с одним конечной точкой.

**Вариант 18.** Создайте `Dockerfile` для приложения на `Go`, которое использует библиотеку Gin для создания простого REST API с одним конечной точкой.

**Вариант 19.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку TensorFlow для загрузки и использования предварительно обученной модели машинного обучения.

**Вариант 20.** Создайте `Dockerfile` для приложения на `Node.js`, которое использует библиотеку Puppeteer для скрапинга веб-страницы и сохранения ее содержимого в файл.

**Вариант 21.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку OpenCV для загрузки изображения и применения к нему простого фильтра.

**Вариант 22.** Создайте `Dockerfile` для приложения на `Java`, которое использует библиотеку Apache POI для чтения данных из файла Excel и вывода их содержимого.

**Вариант 23.** Создайте `Dockerfile` для приложения на `PHP`, которое использует библиотеку PHPMailer для отправки электронного письма через SMTP-сервер.

**Вариант 24.** Создайте `Dockerfile` для приложения на `Python`, которое использует библиотеку Pygame для создания простой 2D-игры.

**Вариант 25.** Создайте `Dockerfile` для приложения на `Node.js`, которое использует библиотеку Socket.IO для создания простого чата в реальном времени.

### Форма отчета:
1. Титульный лист.
2. Цель работы.
3. Ход выполнения работы (с указанием используемых команд и их результатов).
4. Листинг созданного Dockerfile.
5. Выводы по работе.
6. Ответы на контрольные вопросы.

### Контрольные вопросы:
1. Что такое Dockerfile и для чего он используется?
2. Какие основные инструкции используются в Dockerfile?
3. Как выполняется сборка образа Docker с использованием Dockerfile?
4. Как запустить контейнер из собранного образа?
5. Каковы преимущества использования Dockerfile для создания образов Docker?
