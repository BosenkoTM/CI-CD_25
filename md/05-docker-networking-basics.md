# Урок 5: Основы сетей Docker

## Введение в сети Docker

Сети — это важный аспект контейнеризации, позволяющий контейнерам взаимодействовать друг с другом и с внешними системами. Docker предоставляет гибкую сетевую модель, которая позволяет вам настраивать способ подключения и взаимодействия контейнеров.

## Понимание сетевой модели в Docker

Docker использует архитектуру клиент-сервер, в которой клиент Docker взаимодействует с демоном Docker (сервером). Демон Docker управляет контейнерами и их сетями. Каждый контейнер может быть подключен к одной или нескольким сетям, что позволяет взаимодействовать с другими контейнерами и внешними службами.

### Ключевые концепции

- **Пространство имен сети**: каждый контейнер Docker работает в своем собственном пространстве имен сети, обеспечивая изоляцию сетевых конфигураций.
- **IP-адрес**: каждому контейнеру назначается уникальный IP-адрес в его сети, что позволяет ему взаимодействовать с другими контейнерами.
- **Порты**: контейнеры могут предоставлять порты для внешнего доступа к службам, работающим внутри них.

## Как контейнеры взаимодействуют

Контейнеры могут взаимодействовать друг с другом, используя свои IP-адреса или имена контейнеров, в зависимости от конфигурации сети. Docker предоставляет несколько сетевых опций для упрощения этого взаимодействия.

## Типы сетей Docker

Docker поддерживает несколько типов сетей, каждый из которых обслуживает различные варианты использования. Вот наиболее распространенные типы:

### 1. **Сеть моста**

- **Тип сети по умолчанию**: когда создаете контейнер без указания сети, Docker подключает его к сети моста по умолчанию.
- **Вариант использования**: подходит для автономных контейнеров, которым необходимо взаимодействовать друг с другом на одном хосте.
- **Связь**: контейнеры могут взаимодействовать, используя свои IP-адреса или имена контейнеров.

**Пример**: Чтобы создать новый контейнер в сети моста:

```bash
docker run -d --name my-container --network bridge nginx
```

### 2. **Сеть хоста**

- **Прямой доступ к хосту**: контейнеры совместно используют сетевой стек хоста, то есть они используют IP-адрес хоста и могут напрямую получать доступ к службам на хосте.
- **Вариант использования**: полезно для приложений, чувствительных к производительности, которым требуется низкая задержка и прямой доступ к службам хоста.
- **Ограничение**: контейнеры не могут иметь собственные IP-адреса; они совместно используют IP-адреса хоста.

**Пример**: запуск контейнера с использованием хостовой сети:

```bash
docker run -d --name my-container --network host nginx
```

### 3. **Оверлейная сеть**

- **Многохостовая сеть**: позволяет контейнерам, работающим на разных хостах Docker, безопасно взаимодействовать.
- **Вариант использования**: идеально подходит для приложений, развернутых в режиме роя или на нескольких хостах, что позволяет обнаруживать службы и балансировать нагрузку.
- **Конфигурация**: требуется хранилище ключей и значений (например, Consul или etcd) для управления состоянием сети.

**Пример**: Чтобы создать оверлейную сеть:

```bash
docker network create --driver overlay my-overlay-network
```

### 4. **Сеть Macvlan**

- **Пользовательские MAC-адреса**: Позволяет назначить MAC-адрес контейнеру, сделав его видимым как физическое устройство в сети.
- **Способ использования**: Полезно для приложений, которым требуется прямой доступ к физической сети, например, устаревших приложений.
- **Конфигурация**: Требует дополнительной настройки для физического сетевого интерфейса.

**Пример**: Чтобы создать сеть macvlan:

```bash
docker network create -d macvlan --subnet=192.168.1.0/24 --gateway=192.168.1.1 -o parent=eth0 my-macvlan
```

### 5. **Нет сети**

- **Нет сети**: Контейнеры, подключенные к этой сети, не имеют доступа к сети.
- **Вариант использования**: Полезно для приложений, которым не требуется подключение к сети, или для целей тестирования.

**Пример**: запуск контейнера без сети:

```bash
docker run -d --name my-container --network none nginx
```

## Управление сетями Docker

### Список сетей

Чтобы просмотреть все сети Docker в вашей системе, используйте:

```bash
docker network ls
```

### Проверка сети

Чтобы получить подробную информацию о конкретной сети, используйте:

```bash
docker network inspect <имя-сети>
```

### Удаление сети

Чтобы удалить сеть, которая больше не используется, используйте:

```bash
docker network rm <имя-сети>
```

## Заключение

В этом уроке вы узнали о сетевой модели Docker и о том, как взаимодействуют контейнеры. Вы также изучили различные типы сетей Docker и варианты их использования. Понимание сетей Docker необходимо для создания масштабируемых и эффективных контейнерных приложений. В следующем уроке мы погрузимся в управление данными в Docker, сосредоточившись на томах и постоянном хранилище.

