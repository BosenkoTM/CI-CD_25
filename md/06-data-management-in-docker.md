# Урок 6: Управление данными в Docker

## Введение в управление данными в Docker

Сохранение данных — важный аспект управления приложениями в контейнерах Docker. По умолчанию данные, хранящиеся внутри контейнера, являются эфемерными, то есть они теряются при удалении контейнера. Для эффективного управления данными Docker предоставляет два основных механизма: **том**(volumes) и **связанные монтирования**(bind mounts). В этом уроке будут рассмотрены оба метода и их использование для сохранения данных в ваших приложениях.

## Понимание томов

**Том** — предпочтительный способ хранения данных в Docker. Они управляются Docker и обеспечивают ряд преимуществ по сравнению с хранением данных в файловой системе контейнера.

### Основные характеристики томов:
- **Управление Docker**: Docker управляет созданием, хранением и управлением томами.
- **Постоянное хранилище**: данные, хранящиеся в томах, сохраняются даже после остановки или удаления контейнера.

- **Общий доступ к данным**: тома могут совместно использоваться несколькими контейнерами, что упрощает управление данными в разных сервисах.
- **Производительность**: тома оптимизированы для производительности, особенно для операций ввода-вывода.

### Создание и использование томов

1. **Создание тома**: вы можете создать том с помощью следующей команды:

```bash
docker volume create my-volume
```

2. **Запуск контейнера с томом**: чтобы использовать том в контейнере, вы можете смонтировать его с помощью флага `-v` или `--mount`:

```bash
docker run -d --name my-container -v my-volume:/data nginx
```

В этом примере том `my-volume` смонтирован в каталог `/data` внутри контейнера.

3. **Проверка тома**: Чтобы просмотреть сведения о конкретном томе, используйте:

```bash
docker volume inspect my-volume
```

4. **Список всех томов**: Чтобы просмотреть все тома в вашей системе, выполните:

```bash
docker volume ls
```

5. **Удаление тома**: Чтобы удалить том, который больше не нужен, убедитесь, что его не используют ни один контейнер, затем выполните:

```bash
docker volume rm my-volume
```

## Понимание Bind Mounts

**Bind Mounts** позволяют вам монтировать определенный каталог из вашей файловой системы хоста в контейнер. Это полезно для сред разработки, где вы хотите работать с файлами на вашей хост-машине.

### Основные характеристики монтирований Bind:
- **Зависимость от хоста**: монтирования Bind зависят от файловой системы хоста. Изменения, внесенные в смонтированный каталог, отражаются как на хосте, так и в контейнере.
- **Гибкость**: вы можете смонтировать любой каталог с хоста, что упрощает обмен файлами между хостом и контейнером.
- **Не управляется Docker**: в отличие от томов, монтирования привязки не управляются Docker, поэтому перед монтированием необходимо убедиться, что каталог хоста существует.

### Создание и использование монтирований привязки

1. **Запуск контейнера с Bind Mounts**: чтобы создать монтирование привязки, укажите каталог хоста и каталог контейнера во флаге `-v`:

```bash
docker run -d --name my-container -v /path/on/host:/data nginx
```

Замените `/path/on/host` на фактический путь к каталогу на вашем хосте, который вы хотите смонтировать.

2. **Проверка Bind Mounts**: Вы можете проверить содержимое смонтированного каталога внутри контейнера, выполнив:

```bash
docker exec -it my-container ls /data
```

3. **Удаление контейнера с Bind Mounts**: При удалении контейнера Bind Mounts останется в файловой системе хоста, так как Docker им не управляет.

## Эффективное управление данными в контейнерах Docker

### Лучшие практики управления данными

1. **Использование томов для постоянных данных**: Всякий раз, когда вам нужно хранить данные, которые должны сохраняться после окончания жизненного цикла контейнера, используйте тома Docker.

2. **Использование Bind Mounts для разработки**: В целях разработки Bind Mounts полезны, поскольку они позволяют редактировать файлы на вашем хосте и немедленно видеть изменения, отраженные в контейнере.

3. **Резервное копирование и восстановление томов**: Регулярно создавайте резервные копии томов, чтобы предотвратить потерю данных. Вы можете создать tarball с данными тома, используя следующую команду:

```bash
docker run --rm -v my-volume:/data -v $(pwd):/backup alpine tar czf /backup/my-volume-backup.tar.gz -C /data .
```

4. **Очистка неиспользуемых томов**: периодически проверяйте и удаляйте неиспользуемые тома, чтобы освободить место на диске. Используйте:

```bash
docker volume prune
```

## Заключение

В этом уроке вы узнали о томах Docker и привязках монтирования для сохранения данных, а также о том, как эффективно управлять данными в контейнерах Docker. Понимание этих концепций необходимо для создания надежных и масштабируемых приложений с помощью Docker. В следующем уроке мы рассмотрим Docker Compose — инструмент, который упрощает управление многоконтейнерными приложениями.
